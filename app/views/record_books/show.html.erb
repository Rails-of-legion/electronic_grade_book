<div class="container">
  <h1 class="mb-4">Record Book</h1>

  <p>
    <strong>Student:</strong> <%= @record_book.user.name %>
  </p>

  <%= simple_form_for :grade, url: record_book_path(@record_book, month: params[:month]), method: :get, html: { class: 'form-inline mb-4' } do |f| %>
    <%= f.input :selected_month, collection: Date::MONTHNAMES.compact.each_with_index.map { |name, i| [name, i+1] }, prompt: 'Select a month', input_html: { onchange: 'this.form.submit();', name: 'month', class: 'form-control' } %>
    <%= hidden_field_tag :year, Time.now.year %>
  <% end %>

  <table class="table table-striped table-bordered">
    <thead>
      <tr>
        <th><%= Date::MONTHNAMES[@month.to_i] %></th>
        <% (1..Time.days_in_month(@month.to_i)).each do |day| %>
          <th><%= day %></th>
        <% end %>
      </tr>
    </thead>
    <tbody>
      <% @record_book.specialization.subjects.each do |subject| %>
        <tr>
          <td><%= subject.name %></td>
          <% (1..Time.days_in_month(@month.to_i)).each do |day| %>
            <td>
              <% date = Date.new(Time.current.year, @month.to_i, day) %>
              <% grade = subject.grades.find { |g| g.date == date } %>
              <% if grade %>
                <%= grade.grade %>
              <% end %>
            </td>
          <% end %>
        </tr>
      <% end %>
    </tbody>
  </table>

  <% if current_user.has_role? :student %>
    <%= link_to 'Back', user_path(current_user), class: 'btn btn-light' %>
  <% else %>
    <%= link_to 'Back', record_books_path, class: 'btn btn-light' %>
  <% end %>
</div>
